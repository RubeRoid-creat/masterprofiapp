# Диагностика проблемы "Не удалось подключиться к серверу"

## Текущая ошибка:
```
Не удалось подключиться к серверу (http://212.74.227.208:3000/). 
Проверьте:
• Подключение к интернету
• Доступность сервера
• Настройки сети или VPN
```

## Шаги диагностики:

### 1. Проверьте доступность сервера

**На Windows (PowerShell):**
```powershell
# Проверка доступности порта
Test-NetConnection -ComputerName 212.74.227.208 -Port 3000

# Проверка через curl
curl http://212.74.227.208:3000/

# Ping сервера
ping 212.74.227.208
```

**На Linux/Mac:**
```bash
# Проверка порта
nc -zv 212.74.227.208 3000

# Проверка через curl
curl -v http://212.74.227.208:3000/

# Ping
ping 212.74.227.208
```

### 2. Проверьте, запущен ли сервер

**Подключитесь к серверу через SSH:**
```bash
ssh user@212.74.227.208
```

**Проверьте статус сервера:**
```bash
# Через PM2
pm2 status
pm2 logs bestapp-backend

# Или через ps
ps aux | grep node

# Проверьте, слушает ли процесс порт 3000
sudo netstat -tulpn | grep 3000
# или
sudo ss -tulpn | grep 3000
```

**Если сервер не запущен, запустите:**
```bash
cd /path/to/backend
pm2 start server.js
# или
npm start
```

### 3. Проверьте firewall

**На сервере:**
```bash
# Проверьте правила firewall
sudo ufw status
sudo iptables -L -n | grep 3000

# Если порт закрыт, откройте его
sudo ufw allow 3000/tcp
```

### 4. Проверьте настройки сервера

**Убедитесь, что сервер слушает на правильном интерфейсе:**

В `backend/server.js` или `backend/config.js` проверьте:
```javascript
const PORT = process.env.PORT || 3000;
app.listen(PORT, '0.0.0.0', () => {
  console.log(`Server running on port ${PORT}`);
});
```

**Важно:** Сервер должен слушать на `0.0.0.0`, а не на `localhost` или `127.0.0.1`, чтобы быть доступным извне.

### 5. Проверьте настройки сети на устройстве

**В Android:**
- Убедитесь, что Wi-Fi или мобильные данные включены
- Проверьте, не блокирует ли что-то подключение (VPN, прокси, корпоративный firewall)
- Попробуйте открыть сервер в браузере на устройстве: `http://212.74.227.208:3000/`

### 6. Проверьте логи приложения

**В Android Studio Logcat:**
- Отфильтруйте по тегу: `RetrofitClient`, `ApiRepository`, `MainActivity`
- Ищите сообщения:
  - `❌ Сервер недоступен`
  - `❌ No network connection`
  - `Network check: ❌ Not connected`

### 7. Возможные решения

#### Решение 1: Сервер не запущен
```bash
# На сервере
cd /path/to/backend
pm2 restart bestapp-backend
# или
pm2 start server.js --name bestapp-backend
```

#### Решение 2: Порт закрыт в firewall
```bash
# Откройте порт
sudo ufw allow 3000/tcp
sudo systemctl restart ufw
```

#### Решение 3: Сервер слушает не на том интерфейсе
Измените в коде сервера:
```javascript
app.listen(3000, '0.0.0.0', () => {
  console.log('Server listening on 0.0.0.0:3000');
});
```

#### Решение 4: Изменился IP сервера
Если IP сервера изменился, обновите `BASE_URL` в:
- `app/src/main/java/com/example/bestapp/api/RetrofitClient.kt` (строка 21)

#### Решение 5: Проблемы с сетью на устройстве
- Переключитесь между Wi-Fi и мобильными данными
- Отключите VPN
- Проверьте корпоративный firewall

### 8. Альтернативный URL для тестирования

Если нужно протестировать с локальным сервером, временно измените `BASE_URL`:
```kotlin
// Для эмулятора Android
const val BASE_URL = "http://10.0.2.2:3000/"

// Для реального устройства (локальный сервер)
const val BASE_URL = "http://192.168.1.XXX:3000/" // замените XXX на IP вашего компьютера
```

## Проверка через приложение

При запуске приложения автоматически проверяется доступность сервера. Результат записывается в логи:

**Успешная проверка:**
```
✅ Сервер доступен (код: 200)
```

**Ошибка:**
```
❌ Сервер недоступен: ...
```

## Контакты для помощи

Если проблема не решена:
1. Проверьте логи сервера: `pm2 logs bestapp-backend`
2. Проверьте логи приложения в Android Studio
3. Проверьте доступность сервера через браузер: `http://212.74.227.208:3000/`

---

**Текущий URL сервера:** `http://212.74.227.208:3000/`




