# Как войти в админ-панель

## Запуск админ-панели

### Шаг 1: Перейти в папку админ-панели

```powershell
cd Z:\BestAPP\backend\admin-panel
```

### Шаг 2: Установить зависимости (если еще не установлены)

```powershell
npm install
```

### Шаг 3: Настроить переменные окружения

Создайте файл `.env` в папке `Z:\BestAPP\backend\admin-panel`:

```env
VITE_API_URL=http://212.74.227.208:3000/api
```

Или для локальной разработки:
```env
VITE_API_URL=http://localhost:3000/api
```

### Шаг 4: Запустить админ-панель

```powershell
npm run dev
```

Админ-панель будет доступна по адресу: **http://localhost:5173/admin**

## Вход в админ-панель

### Вариант 1: Если у вас уже есть учетные данные

1. Откройте http://localhost:5173/admin/login
2. Введите email и пароль администратора
3. Нажмите "Войти"

**Важно:** Требуется роль 'admin' для входа.

### Вариант 2: Регистрация нового администратора

1. Откройте http://localhost:5173/admin/register
2. Заполните форму регистрации:
   - Email
   - Пароль
   - Имя
   - Телефон
3. Нажмите "Зарегистрироваться"

**Примечание:** Регистрация может требовать подтверждения или создания через backend.

### Вариант 3: Создать администратора через backend

Если регистрация недоступна, создайте пользователя напрямую в базе данных backend:

```sql
-- Для SQLite (если backend использует SQLite)
INSERT INTO users (email, password_hash, name, phone, role, email_verified, phone_verified)
VALUES (
  'admin@ispravleno.ru',
  'хешированный_пароль', -- Используйте bcrypt для хеширования пароля
  'Администратор',
  '+79999999999',
  'admin',
  1,
  1
);
```

Для хеширования пароля можно использовать Node.js:
```javascript
const bcrypt = require('bcrypt');
const hash = bcrypt.hashSync('ваш_пароль', 10);
console.log(hash);
```

## Получение токена для интеграции

После успешного входа:

### Способ 1: Через консоль браузера

1. Войдите в админ-панель
2. Откройте консоль разработчика (F12)
3. Выполните:
```javascript
localStorage.getItem('admin_token')
```
4. Скопируйте полученный токен

### Способ 2: Через API напрямую

```powershell
# Вход через API
$response = Invoke-RestMethod -Uri "http://212.74.227.208:3000/api/auth/login" `
  -Method POST `
  -ContentType "application/json" `
  -Body '{"email":"admin@ispravleno.ru","password":"ваш_пароль"}'

# Токен будет в $response.token
$response.token
```

### Способ 3: Через curl (если установлен)

```bash
curl -X POST http://212.74.227.208:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@ispravleno.ru","password":"ваш_пароль"}'
```

## Добавление токена в сайт

После получения токена:

1. Откройте файл `.env` в папке сайта (`Z:\SeoСайтИсправно`)
2. Добавьте:
```env
ADMIN_USER_TOKEN="ваш_jwt_токен_здесь"
```
3. Перезапустите Next.js сервер:
```powershell
npm run dev
```

## Проверка работы

1. Создайте заказ на сайте
2. Проверьте логи сервера - должно быть сообщение об успешной отправке
3. Откройте админ-панель → раздел "Заказы"
4. Проверьте, что заказ появился

## Устранение проблем

### Ошибка: "Доступ разрешен только администраторам"
- Убедитесь, что пользователь имеет роль 'admin' в базе данных

### Ошибка: "Не удалось подключиться к серверу"
- Проверьте, что backend запущен
- Проверьте правильность `VITE_API_URL` в `.env` админ-панели

### Ошибка: "401 Unauthorized" при создании заказа
- Проверьте, что `ADMIN_USER_TOKEN` добавлен в `.env` сайта
- Убедитесь, что токен не истек (попробуйте войти заново)

## Структура URL админ-панели

- `/admin/login` - страница входа
- `/admin/register` - страница регистрации
- `/admin/` - дашборд (требует авторизации)
- `/admin/orders` - управление заказами
- `/admin/users` - управление пользователями
- `/admin/verification` - верификация мастеров
- `/admin/complaints` - жалобы
- `/admin/backups` - бэкапы

