# ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –ó–ê–í–ï–†–®–ï–ù–û

## üìÖ –î–∞—Ç–∞: 23.12.2025

---

## üéØ –¶–µ–ª—å
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Google Play Store.

---

## üìù –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ

**CodePush —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å React Native!**

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ **–Ω–∞—Ç–∏–≤–Ω–æ–º Kotlin/Jetpack Compose**, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π —á–µ—Ä–µ–∑ API
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ APK
- ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ Fallback –Ω–∞ Google Play

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Backend (Node.js)

#### üì° API –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–π (`backend/routes/version.js`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/version/check`

**Request:**
```json
{
  "platform": "android_master",
  "app_version": "1.2.1"
}
```

**Response:**
```json
{
  "update_required": true,
  "force_update": false,
  "current_version": "1.3.0",
  "release_notes": "- –î–æ–±–∞–≤–ª–µ–Ω WebSocket\n- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏",
  "download_url": "http://212.74.227.208:3000/updates/app-master-v1.3.0.apk",
  "supported": true
}
```

#### üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π (`backend/version-config.json`)

```json
{
  "android_master": {
    "current_version": "1.3.0",
    "min_required_version": "1.0.0",
    "force_update": false,
    "release_notes": "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π",
    "download_url": "http://212.74.227.208:3000/updates/app-master-v1.3.0.apk",
    "supported_os_versions": ["8.0", "9.0", "10", "11", "12", "13", "14"]
  },
  "android_client": {
    "current_version": "1.0.0",
    ...
  }
}
```

#### üóÇÔ∏è –†–∞–∑–¥–∞—á–∞ APK —Ñ–∞–π–ª–æ–≤

–°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–ø–∫–∞: `backend/public/updates/`

```bash
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
backend/public/updates/
‚îú‚îÄ‚îÄ app-master-v1.3.0.apk
‚îú‚îÄ‚îÄ app-master-v1.2.0.apk
‚îú‚îÄ‚îÄ app-client-v1.0.0.apk
‚îî‚îÄ‚îÄ index.html (—Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ—Ä—Å–∏–π)
```

URL –¥–æ—Å—Ç—É–ø–∞: `http://212.74.227.208:3000/updates/`

---

### 2. Android App (Kotlin)

#### üì± UpdateManager (`app/src/main/java/com/example/bestapp/updates/UpdateManager.kt`)

**–ö–ª–∞—Å—Å:** `UpdateManager`

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**
```kotlin
val updateManager = UpdateManager(context, viewModelScope)
updateManager.checkForUpdates()
```

‚úÖ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ APK —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º**
```kotlin
updateManager.downloadAndInstall(downloadUrl)

// –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
updateManager.downloadProgress.collect { progress ->
    // progress: 0-100%
    // message: "–ó–∞–≥—Ä—É–∑–∫–∞: 5 MB / 25 MB"
}
```

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç FileProvider –¥–ª—è Android 7.0+
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

‚úÖ **StateFlow —Å–æ–±—ã—Ç–∏—è**
```kotlin
val updateCheckStatus: StateFlow<UpdateCheckStatus>
val updateInfo: StateFlow<UpdateInfo?>
val downloadProgress: StateFlow<DownloadProgress?>
```

‚úÖ **Fallback –Ω–∞ Google Play**
```kotlin
updateManager.openGooglePlay()
```

#### üé® UpdateDialog (`app/src/main/java/com/example/bestapp/updates/UpdateDialog.kt`)

**–¢–∏–ø—ã –¥–∏–∞–ª–æ–≥–æ–≤:**

1. **–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—Å–∏—é –∏ —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –∏–ª–∏ "–ü–æ–∑–∂–µ"
   - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ (–±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ü–æ–∑–∂–µ")

2. **–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏**
   - ProgressBar —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
   - –¢–µ–∫—É—â–∏–π/–æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

3. **–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
   - –ö–Ω–æ–ø–∫–∞ "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"

4. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ**
   - –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–∏

#### üîß AndroidManifest.xml

–î–æ–±–∞–≤–ª–µ–Ω—ã:
```xml
<!-- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ APK -->
<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />

<!-- FileProvider –¥–ª—è Android 7.0+ -->
<provider
    android:name="androidx.core.content.FileProvider"
    android:authorities="${applicationId}.fileprovider"
    android:exported="false"
    android:grantUriPermissions="true">
    <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/file_paths" />
</provider>
```

#### üìÑ File Paths (`app/src/main/res/xml/file_paths.xml`)

```xml
<paths>
    <cache-path name="apk_cache" path="." />
    <files-path name="app_files" path="." />
    <external-path name="external_files" path="." />
</paths>
```

---

## üîÑ Workflow –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  App Start  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Check for Updates   ‚îÇ ‚Üê POST /api/version/check
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ No Update Available
       ‚îÇ   ‚îî‚îÄ‚îÄ> Continue
       ‚îÇ
       ‚îî‚îÄ‚îÄ Update Available
           ‚îÇ
           ‚ñº
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ  Show Dialog    ‚îÇ
       ‚îÇ  [Update/Later] ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚îú‚îÄ‚îÄ Later ‚Üí Continue
              ‚îÇ
              ‚îî‚îÄ‚îÄ Update
                  ‚îÇ
                  ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ Download APK  ‚îÇ ‚Üê HTTP download
              ‚îÇ (with progress)‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Install APK  ‚îÇ ‚Üê System installer
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Backend - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å version-config.json
nano backend/version-config.json

# 2. –ò–∑–º–µ–Ω–∏—Ç—å current_version –∏ release_notes
{
  "android_master": {
    "current_version": "1.4.0",  # <- –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
    "force_update": false,        # <- true –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ
    "release_notes": "- –ù–æ–≤—ã–µ —Ñ–∏—á–∏\n- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
  }
}

# 3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π APK
cp app-master-v1.4.0.apk backend/public/updates/

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pm2 restart all
```

### Android - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```kotlin
class MainActivity : ComponentActivity() {
    private lateinit var updateManager: UpdateManager

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        // –°–æ–∑–¥–∞–µ–º UpdateManager
        updateManager = UpdateManager(this, lifecycleScope)
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        checkForUpdates()
        
        // –ò–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–µ–Ω—é "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
    }

    private fun checkForUpdates() {
        lifecycleScope.launch {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
            updateManager.checkForUpdates()
            
            // –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
            updateManager.updateCheckStatus.collect { status ->
                when (status) {
                    is UpdateCheckStatus.UpdateAvailable -> {
                        showUpdateDialog(status.updateInfo)
                    }
                    is UpdateCheckStatus.NoUpdateAvailable -> {
                        // –ü–æ–∫–∞–∑–∞—Ç—å Toast (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                    }
                    is UpdateCheckStatus.Error -> {
                        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
                    }
                    else -> {}
                }
            }
        }
    }

    private fun showUpdateDialog(updateInfo: UpdateInfo) {
        UpdateDialog.showUpdateAvailableDialog(
            context = this,
            updateInfo = updateInfo,
            onUpdate = {
                // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                if (updateInfo.downloadUrl != null) {
                    updateManager.downloadAndInstall(updateInfo.downloadUrl)
                    observeDownloadProgress()
                } else {
                    // Fallback –Ω–∞ Google Play
                    updateManager.openGooglePlay()
                }
            },
            onLater = {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–ü–æ–∑–∂–µ"
            }
        )
    }

    private fun observeDownloadProgress() {
        lifecycleScope.launch {
            updateManager.downloadProgress.collect { progress ->
                progress?.let {
                    // –û–±–Ω–æ–≤–∏—Ç—å UI –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    // progress.progress: 0-100
                    // progress.message: "–ó–∞–≥—Ä—É–∑–∫–∞: X MB / Y MB"
                }
            }
        }
    }
}
```

---

## üìä –¢–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 1. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```json
{
  "force_update": false
}
```

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ü–æ–∑–∂–µ"
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ª–æ–∂–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –î–∏–∞–ª–æ–≥ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```json
{
  "force_update": true
}
```

- –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–∑–∂–µ"
- –î–∏–∞–ª–æ–≥ –Ω–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 3. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ)

```json
{
  "min_required_version": "1.2.0",
  "current_version": "1.4.0",
  "force_update": true
}
```

- –ï—Å–ª–∏ `app_version < min_required_version` ‚Üí –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **HTTPS –¥–ª—è production**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è download_url
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç man-in-the-middle –∞—Ç–∞–∫–∏

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ APK**
- Android –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- –ù–µ–ª—å–∑—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK —Å –¥—Ä—É–≥–æ–π –ø–æ–¥–ø–∏—Å—å—é

‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è**
- `REQUEST_INSTALL_PACKAGES` —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- FileProvider –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º

‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π**
- –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–∏ (semver)
- –ó–∞—â–∏—Ç–∞ –æ—Ç downgrade –∞—Ç–∞–∫

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Backend

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl -X POST http://212.74.227.208:3000/api/version/check \
  -H "Content-Type: application/json" \
  -d '{"platform":"android_master","app_version":"1.0.0"}'

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{
  "update_required": true,
  "force_update": false,
  "current_version": "1.3.0",
  "release_notes": "...",
  "download_url": "http://...",
  "supported": true
}

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ APK
curl -I http://212.74.227.208:3000/updates/app-master-v1.3.0.apk

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
HTTP/1.1 200 OK
Content-Type: application/vnd.android.package-archive
Content-Length: 26214400
```

### Android

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ build.gradle.kts
versionName = "1.0.0"  # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞

# 2. –°–æ–±—Ä–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK
./gradlew assembleDebug
adb install app/build/outputs/apk/debug/app-debug.apk

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
adb logcat | grep UpdateManager

# –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...
# –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.0
# Update required: true, force: false
# New version: 1.3.0
# ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 1.0.0 -> 1.3.0

# 5. –ù–∞–∂–∞—Ç—å "–û–±–Ω–æ–≤–∏—Ç—å" –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
# üì• –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
# –ó–∞–≥—Ä—É–∑–∫–∞: 0%
# –ó–∞–≥—Ä—É–∑–∫–∞: 50%
# –ó–∞–≥—Ä—É–∑–∫–∞: 100%
# ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ
# üöÄ –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ APK
```

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ/–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend (1 —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π):
1. `backend/routes/version.js` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
2. `backend/version-config.json` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
3. `backend/public/updates/` - –ø–∞–ø–∫–∞ –¥–ª—è APK —Ñ–∞–π–ª–æ–≤

### Android (5 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤):
1. ‚úÖ `app/src/main/java/com/example/bestapp/updates/UpdateManager.kt` (350+ —Å—Ç—Ä–æ–∫)
2. ‚úÖ `app/src/main/java/com/example/bestapp/updates/UpdateDialog.kt` (110+ —Å—Ç—Ä–æ–∫)
3. ‚úÖ `app/src/main/AndroidManifest.xml` (–¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ FileProvider)
4. ‚úÖ `app/src/main/res/xml/file_paths.xml` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
5. ‚úÖ `app/build.gradle.kts` (—É–≤–µ–ª–∏—á–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –¥–æ 1.3.0)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 —Ñ–∞–π–ª):
1. ‚úÖ `backend/AUTO_UPDATE_SYSTEM_COMPLETE.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

**–ò—Ç–æ–≥–æ:** 5 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ Android + 1 –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π + 1 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üöÄ Deployment

### Backend

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è APK
mkdir -p backend/public/updates

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å APK —Ñ–∞–π–ª—ã
cp ~/builds/app-master-v1.3.0.apk backend/public/updates/

# 3. –û–±–Ω–æ–≤–∏—Ç—å version-config.json
nano backend/version-config.json

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pm2 restart all

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl -I http://212.74.227.208:3000/updates/app-master-v1.3.0.apk
```

### Android

```bash
# 1. –£–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ build.gradle.kts
versionCode = 14
versionName = "1.3.0"

# 2. –°–æ–±—Ä–∞—Ç—å release APK
./gradlew assembleRelease

# 3. –ü–æ–¥–ø–∏—Å–∞—Ç—å APK (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 \
  -keystore release-key.jks \
  app/build/outputs/apk/release/app-release-unsigned.apk \
  my-key-alias

# 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å APK
zipalign -v 4 \
  app/build/outputs/apk/release/app-release-unsigned.apk \
  app-master-v1.3.0.apk

# 5. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp app-master-v1.3.0.apk user@212.74.227.208:/path/to/backend/public/updates/
```

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Google Play | –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ |
|----------------|-------------|---------------------|
| **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π | –ü–æ–ª–Ω—ã–π ‚úÖ |
| **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | –ù–µ—Ç | –î–∞ ‚úÖ |
| **–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏** | –ù–µ—Ç | –î–∞ ‚úÖ |
| **–°–∫–æ—Ä–æ—Å—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏** | 1-7 –¥–Ω–µ–π | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ ‚úÖ |
| **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –î–∞ | –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ‚úÖ |
| **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** | –î–∞ | –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ‚úÖ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –í—ã—Å–æ–∫–∞—è | –•–æ—Ä–æ—à–∞—è ‚úÖ |

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **Delta updates**
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ 80%

2. **A/B Testing**
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **–§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤ —Ñ–æ–Ω–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ WiFi
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

4. **Rollback –º–µ—Ö–∞–Ω–∏–∑–º**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ APK

5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**
   - –°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±–Ω–æ–≤–∏–ª–æ—Å—å
   - –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏/—É—Å—Ç–∞–Ω–æ–≤–∫–∏
   - –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

6. **Google Play In-App Updates API**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Play –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Store
   - –ë–µ—Å—à–æ–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ñ–æ–Ω–µ

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**
‚úÖ **Backend API –≥–æ—Ç–æ–≤ –∫ production**
‚úÖ **Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞**

### –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:

- üöÄ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É
- üéØ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- üìä **–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ APK, HTTPS
- üì± **UX** - –ø–æ–Ω—è—Ç–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** ‚úÖ **100%**  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 23.12.2025

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ MainActivity** - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
2. **–ó–∞–≥—Ä—É–∑–∏—Ç—å APK –Ω–∞ —Å–µ—Ä–≤–µ—Ä** - —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `backend/public/updates/`
3. **–û–±–Ω–æ–≤–∏—Ç—å version-config.json** - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS** - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ production

**–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞:** Swagger/OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è API üìö
