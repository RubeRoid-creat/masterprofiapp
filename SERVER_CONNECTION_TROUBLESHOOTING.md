# Диагностика проблем подключения к серверу

## Что было улучшено:

1. ✅ **Улучшены сообщения об ошибках** - теперь показывают URL сервера и рекомендации
2. ✅ **Добавлена автоматическая повторная попытка** - `retryOnConnectionFailure(true)`
3. ✅ **Оптимизированы таймауты** - connectTimeout 15 секунд
4. ✅ **Добавлена функция проверки доступности сервера** - `checkServerAvailability()`

## Возможные причины проблемы:

### 1. Сервер недоступен
- IP: `212.74.227.208:3000`
- Проверьте, запущен ли сервер на этом адресе
- Проверьте логи сервера

### 2. Проблемы с сетью
- Проверьте подключение к интернету на устройстве
- Убедитесь, что нет блокировки по firewall
- Проверьте, не блокирует ли VPN или прокси-сервер подключение

### 3. Проблемы с Android сетью
- Проверьте настройки сети в Android
- Убедитесь, что приложение имеет разрешение на использование интернета в `AndroidManifest.xml`

### 4. Таймауты
- Таймаут подключения: 15 секунд
- Таймаут чтения: 30 секунд
- Если сервер медленно отвечает, увеличьте таймауты

## Как проверить доступность сервера:

### В приложении (код):
```kotlin
lifecycleScope.launch {
    val (isAvailable, message) = RetrofitClient.checkServerAvailability()
    Log.d(TAG, "Server check: $message")
    if (!isAvailable) {
        // Показать пользователю сообщение
    }
}
```

### В командной строке:
```bash
# Проверка доступности сервера
curl -I --connect-timeout 5 http://212.74.227.208:3000/

# Проверка с подробным выводом
curl -v http://212.74.227.208:3000/

# Ping сервера
ping 212.74.227.208
```

### Проверка порта:
```bash
telnet 212.74.227.208 3000
# или
nc -zv 212.74.227.208 3000
```

## Новые сообщения об ошибках:

Теперь пользователь увидит более понятные сообщения:

- **ConnectException**: 
  ```
  Не удалось подключиться к серверу (http://212.74.227.208:3000/). 
  Проверьте:
  • Подключение к интернету
  • Доступность сервера
  • Настройки сети или VPN
  ```

- **SocketTimeoutException**:
  ```
  Превышено время ожидания ответа сервера (http://212.74.227.208:3000/). 
  Проверьте подключение к интернету или попробуйте позже.
  ```

## Что делать если сервер недоступен:

1. **Проверьте статус сервера:**
   - Зайдите на сервер через SSH
   - Проверьте, запущен ли процесс: `pm2 status` или `ps aux | grep node`
   - Проверьте логи: `pm2 logs bestapp-backend`

2. **Перезапустите сервер:**
   ```bash
   pm2 restart bestapp-backend
   # или
   cd /path/to/backend
   npm start
   ```

3. **Проверьте firewall:**
   ```bash
   # Проверьте, открыт ли порт 3000
   sudo ufw status
   sudo netstat -tulpn | grep 3000
   ```

4. **Проверьте конфигурацию сервера:**
   - Убедитесь, что сервер слушает на правильном интерфейсе (0.0.0.0, а не localhost)
   - Проверьте файл `.env` и конфигурацию

## Если нужно изменить URL сервера:

Отредактируйте файл:
- `app/src/main/java/com/example/bestapp/api/RetrofitClient.kt`
- Измените `BASE_URL` на строке 19

---

**URL текущего сервера:** `http://212.74.227.208:3000/`




